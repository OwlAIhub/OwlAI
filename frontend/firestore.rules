rules_version='2'

service cloud.firestore {
  match /databases/{database}/documents {
    // Contact form submissions - allow anyone to create, but not read/update/delete
    match /contacts/{contactId} {
      // Allow anyone to submit a contact form
      allow create: if isValidContactSubmission();
      // Only authenticated admins can read contact submissions
      allow read: if false; // Will be updated when auth is implemented
      // No updates or deletes allowed from client
      allow update, delete: if false;
    }
    
    // Helper function to validate contact form data
    function isValidContactSubmission() {
      let data = request.resource.data;
      return data.keys().hasAll(['name', 'email', 'message', 'timestamp', 'status']) &&
             data.name is string && data.name.size() > 0 && data.name.size() <= 100 &&
             data.email is string && data.email.size() > 0 && data.email.size() <= 255 &&
             data.message is string && data.message.size() > 0 && data.message.size() <= 2000 &&
             data.status == 'new' &&
             data.timestamp == request.time;
    }
    
    // Default deny all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
